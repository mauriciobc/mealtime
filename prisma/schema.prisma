generator client {
  provider      = "prisma-client-js"
  output        = "../node_modules/.prisma/client"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  schemas  = ["public"]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model cats {
  id               String            @id @default(uuid()) @db.Uuid
  created_at       DateTime          @default(now()) @db.Timestamptz(6)
  updated_at       DateTime          @default(now()) @db.Timestamptz(6)
  name             String
  birth_date       DateTime?         @db.Date
  weight           Decimal?          @db.Decimal(5, 2)
  household_id     String            @db.Uuid
  owner_id         String            @db.Uuid
  portion_size     Decimal?          @db.Decimal(5, 2)
  portion_unit     String?           @db.VarChar(255)
  photo_url        String?           @db.VarChar(2048)
  feeding_interval Int?
  notes            String?
  restrictions     String?
  weight_logs      cat_weight_logs[]
  household        households        @relation(fields: [household_id], references: [id])
  owner            profiles          @relation("owner", fields: [owner_id], references: [id])
  feeding_logs     feeding_logs[]
  schedules        schedules[]
  weight_goals     weight_goals[]

  @@index([household_id])
  @@index([owner_id])
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model household_members {
  id           String         @id @default(uuid()) @db.Uuid
  household_id String         @db.Uuid
  user_id      String         @db.Uuid
  role         household_role
  created_at   DateTime       @default(now()) @db.Timestamptz(6)
  household    households     @relation(fields: [household_id], references: [id])
  user         profiles       @relation(fields: [user_id], references: [id])

  @@unique([household_id, user_id])
  @@index([user_id])
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model households {
  id                String              @id @default(uuid()) @db.Uuid
  created_at        DateTime            @default(now()) @db.Timestamptz(6)
  updated_at        DateTime            @default(now()) @db.Timestamptz(6)
  name              String
  description       String?
  owner_id          String              @db.Uuid
  inviteCode        String?             @unique
  cats              cats[]
  feeding_logs      feeding_logs[]
  household_members household_members[]

  @@index([owner_id])
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model profiles {
  id                   String              @id @db.Uuid
  updated_at           DateTime?           @db.Timestamptz(6)
  username             String?             @unique
  full_name            String?
  avatar_url           String?
  email                String?
  timezone             String?
  weight_logs_measured cat_weight_logs[]   @relation("weight_measured_by")
  owned_cats           cats[]              @relation("owner")
  feeding_logs_fed     feeding_logs[]      @relation("feeder")
  household_members    household_members[]
  created_weight_goals weight_goals[]      @relation("createdBy")

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model notifications {
  id         String   @id @default(uuid()) @db.Uuid
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @default(now()) @db.Timestamptz(6)
  user_id    String   @db.Uuid
  title      String
  message    String
  type       String
  is_read    Boolean  @default(false)
  metadata   Json     @default("{}")

  @@index([user_id, is_read, created_at(sort: Desc)])
  @@index([user_id])
  @@index([user_id, created_at(sort: Desc)], map: "notifications_user_created_idx")
  // Note: Partial index for unread notifications (notifications_user_unread_idx) is created via SQL migration
  // as Prisma doesn't support partial indexes (WHERE clause) directly
  @@schema("public")
}

/// Scheduled notifications for future delivery (UTC timestamps)
model scheduledNotification {
  id          String    @id @default(uuid()) @db.Uuid
  userId      String
  catId       String?
  type        String
  title       String
  message     String
  deliverAt   DateTime  @db.Timestamptz(6)
  delivered   Boolean   @default(false)
  deliveredAt DateTime? @db.Timestamptz(6)
  createdAt   DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime  @updatedAt @db.Timestamptz(6)

  @@index([delivered, deliverAt])
  @@schema("public")
}

model schedules {
  id         String   @id @default(uuid()) @db.Uuid
  cat_id     String   @db.Uuid
  type       String
  interval   Int?
  times      String[]
  enabled    Boolean  @default(true)
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @updatedAt @db.Timestamptz(6)
  cat        cats     @relation(fields: [cat_id], references: [id], onDelete: Cascade)

  @@index([cat_id])
  // Note: Partial index for enabled schedules (schedules_cat_enabled_idx) is created via SQL migration
  // as Prisma doesn't support partial indexes (WHERE clause) directly
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model feeding_logs {
  id           String     @id @default(uuid()) @db.Uuid
  created_at   DateTime   @default(now()) @db.Timestamptz(6)
  updated_at   DateTime   @default(now()) @db.Timestamptz(6)
  cat_id       String     @db.Uuid
  household_id String     @db.Uuid
  meal_type    String
  amount       Decimal    @db.Decimal(5, 2)
  unit         String
  notes        String?
  fed_by       String?    @db.Uuid
  fed_at       DateTime   @db.Timestamptz(6)
  food_type    String?
  cat          cats       @relation(fields: [cat_id], references: [id])
  feeder       profiles?  @relation("feeder", fields: [fed_by], references: [id])
  household    households @relation(fields: [household_id], references: [id])

  @@index([cat_id])
  @@index([household_id])
  @@index([fed_by])
  @@index([fed_at])
  @@index([cat_id, fed_at])
  @@index([household_id, fed_at(sort: Desc)], map: "feeding_logs_household_fed_at_idx")
  @@schema("public")
}

model schema_migrations {
  version    String   @id @unique(map: "schema_migrations_version_idx") @db.VarChar(255)
  dirty      Boolean  @default(false)
  applied_at DateTime @default(now()) @db.Timestamptz(6)

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model cat_weight_logs {
  id          String    @id @default(uuid()) @db.Uuid
  created_at  DateTime  @default(now()) @db.Timestamptz(6)
  updated_at  DateTime  @default(now()) @db.Timestamptz(6)
  weight      Decimal   @db.Decimal(5, 2)
  date        DateTime  @db.Date
  cat_id      String    @db.Uuid
  notes       String?
  measured_by String?   @db.Uuid
  cat         cats      @relation(fields: [cat_id], references: [id], onDelete: Cascade)
  measuredBy  profiles? @relation("weight_measured_by", fields: [measured_by], references: [id])

  @@index([date])
  @@index([cat_id, date])
  @@index([measured_by])
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model weight_goals {
  id            String                   @id @default(uuid()) @db.Uuid
  created_at    DateTime                 @default(now()) @db.Timestamptz(6)
  updated_at    DateTime                 @default(now()) @db.Timestamptz(6)
  cat_id        String                   @db.Uuid
  target_weight Decimal                  @db.Decimal(5, 2)
  target_date   DateTime?                @db.Date
  start_weight  Decimal?                 @db.Decimal(5, 2)
  status        String                   @default("active")
  notes         String?
  created_by    String                   @db.Uuid
  goal_name     String
  unit          String
  milestones    weight_goal_milestones[]
  cat           cats                     @relation(fields: [cat_id], references: [id], onDelete: Cascade)
  createdBy     profiles                 @relation("createdBy", fields: [created_by], references: [id])

  @@index([cat_id, status])
  @@index([created_by])
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model weight_goal_milestones {
  id         String       @id @default(uuid()) @db.Uuid
  created_at DateTime     @default(now()) @db.Timestamptz(6)
  goal_id    String       @db.Uuid
  weight     Decimal      @db.Decimal(5, 2)
  date       DateTime     @db.Date
  notes      String?
  goal       weight_goals @relation(fields: [goal_id], references: [id], onDelete: Cascade)

  @@index([goal_id, date])
  @@schema("public")
}

/// Enum for household member roles
enum household_role {
  admin
  member

  @@schema("public")
}

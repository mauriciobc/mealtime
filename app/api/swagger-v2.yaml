openapi: 3.0.0
info:
  title: MealTime API v2
  version: 2.0.0
  description: API v2 com autenticação JWT e respostas padronizadas
  contact:
    name: MealTime Support
    email: support@mealtime.app

servers:
  - url: http://localhost:3000/api/v2
    description: Servidor de desenvolvimento
  - url: https://mealtime.app/api/v2
    description: Servidor de produção

tags:
  - name: Cats
    description: Gerenciamento de gatos
  - name: Feedings
    description: Registro de alimentações
  - name: Weight
    description: Controle de peso dos gatos
  - name: Goals
    description: Metas de peso
  - name: Schedules
    description: Agendamento de alimentações
  - name: Households
    description: Gerenciamento de domicílios
  - name: Users
    description: Gerenciamento de usuários e preferências
  - name: Notifications
    description: Gerenciamento de notificações
  - name: Statistics
    description: Estatísticas e relatórios
  - name: Upload
    description: Upload de arquivos
  - name: Profile
    description: Perfil público de usuários
  - name: ScheduledNotifications
    description: Notificações agendadas

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtido via /api/auth/mobile
    
  schemas:
    ApiResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
        data:
          type: object
        count:
          type: integer
        error:
          type: string
          
    Cat:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        photo_url:
          type: string
          nullable: true
        birth_date:
          type: string
          format: date-time
          nullable: true
        weight:
          type: number
          nullable: true
        household_id:
          type: string
          format: uuid
        owner_id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
          nullable: true
        full_name:
          type: string
          nullable: true
        email:
          type: string
        timezone:
          type: string
          nullable: true
        avatar_url:
          type: string
          nullable: true
    
    UserPreferences:
      type: object
      required:
        - timezone
      properties:
        timezone:
          type: string
          description: Timezone do usuário (ex: America/Sao_Paulo)
        language:
          type: string
          nullable: true
          description: Idioma do usuário (sempre retorna null pois não é persistido no banco de dados)
    
    Notification:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        message:
          type: string
        type:
          type: string
          enum: [feeding, reminder, household, household_invite, system, info, warning, error]
        isRead:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        userId:
          type: string
          format: uuid
        metadata:
          type: object
          additionalProperties: true

paths:
  # ==================== CATS ====================
  /cats:
    get:
      tags: [Cats]
      summary: Listar gatos (v2)
      description: Retorna lista de gatos do household do usuário
      security:
        - BearerAuth: []
      parameters:
        - name: householdId
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Lista de gatos
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Cat'
        '401':
          description: Não autenticado
        '403':
          description: Acesso negado
    
    post:
      tags: [Cats]
      summary: Criar gato (v2)
      description: Cria um novo gato
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - householdId
              properties:
                name:
                  type: string
                householdId:
                  type: string
                  format: uuid
                photoUrl:
                  type: string
                  nullable: true
                birthdate:
                  type: string
                  format: date-time
                weight:
                  type: number
                feeding_interval:
                  type: integer
                  minimum: 1
                  maximum: 24
      responses:
        '201':
          description: Gato criado
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Cat'
        '400':
          description: Dados inválidos
        '403':
          description: Acesso negado

  /cats/{catId}:
    get:
      tags: [Cats]
      summary: Buscar gato por ID (v2)
      description: Retorna detalhes de um gato específico
      security:
        - BearerAuth: []
      parameters:
        - name: catId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Dados do gato
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Cat'
        '400':
          description: ID inválido
        '403':
          description: Acesso negado
        '404':
          description: Gato não encontrado
    
    put:
      tags: [Cats]
      summary: Atualizar gato (v2)
      description: Atualiza informações de um gato
      security:
        - BearerAuth: []
      parameters:
        - name: catId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                photoUrl:
                  type: string
                  nullable: true
                birthDate:
                  type: string
                  format: date-time
                weight:
                  oneOf:
                    - type: number
                    - type: "null"
                feeding_interval:
                  type: integer
                  minimum: 1
                  maximum: 24
                portion_size:
                  type: number
                  minimum: 0
                restrictions:
                  type: string
                notes:
                  type: string
      responses:
        '200':
          description: Gato atualizado
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Cat'
        '400':
          description: Dados inválidos
        '403':
          description: Acesso negado
        '404':
          description: Gato não encontrado
    
    delete:
      tags: [Cats]
      summary: Deletar gato (v2)
      description: Deleta um gato e todos os registros relacionados
      security:
        - BearerAuth: []
      parameters:
        - name: catId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Gato deletado com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      message:
                        type: string
        '400':
          description: ID inválido
        '403':
          description: Acesso negado
        '404':
          description: Gato não encontrado

  /cats/{catId}/next-feeding:
    get:
      tags: [Cats]
      summary: Calcular próxima alimentação (v2)
      description: Calcula a próxima data/hora de alimentação baseado nos agendamentos e última alimentação
      security:
        - BearerAuth: []
      parameters:
        - name: catId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Próxima alimentação calculada
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          nextFeeding:
                            type: string
                            format: date-time
                            nullable: true
                          catId:
                            type: string
                            format: uuid
                          hasSchedules:
                            type: boolean
                          lastFeedingTime:
                            type: string
                            format: date-time
                            nullable: true
        '403':
          description: Acesso negado
        '404':
          description: Gato não encontrado

  # ==================== FEEDINGS ====================
  /feedings:
    get:
      tags: [Feedings]
      summary: Listar alimentações (v2)
      security:
        - BearerAuth: []
      parameters:
        - name: householdId
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Lista de alimentações
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
    
    post:
      tags: [Feedings]
      summary: Registrar alimentação (v2)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - catId
              properties:
                catId:
                  type: string
                  format: uuid
                amount:
                  type: number
                notes:
                  type: string
                meal_type:
                  type: string
                  enum: [manual, scheduled, automatic]
      responses:
        '201':
          description: Alimentação registrada
        '409':
          description: Alimentação duplicada

  /feedings/{id}:
    get:
      tags: [Feedings]
      summary: Buscar alimentação (v2)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Dados da alimentação
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          catId:
                            type: string
                            format: uuid
                          userId:
                            type: string
                            format: uuid
                          timestamp:
                            type: string
                            format: date-time
                          portionSize:
                            type: number
                          notes:
                            type: string
                            nullable: true
                          mealType:
                            type: string
                          unit:
                            type: string
                          householdId:
                            type: string
                            format: uuid
        '400':
          description: ID inválido
        '403':
          description: Acesso negado
        '404':
          description: Alimentação não encontrada
    
    put:
      tags: [Feedings]
      summary: Atualizar alimentação (v2)
      description: Atualiza um registro de alimentação
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                amount:
                  type: number
                  minimum: 0
                  exclusiveMinimum: true
                  description: "Quantidade de alimento (deve ser um número positivo). Não pode ser null pois o campo é obrigatório no banco de dados."
                notes:
                  type: string
                  maxLength: 255
                  nullable: true
                meal_type:
                  type: string
                  enum: [manual, scheduled, automatic]
                unit:
                  type: string
                  enum: [g, ml, cups, oz]
      responses:
        '200':
          description: Alimentação atualizada
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          catId:
                            type: string
                            format: uuid
                          timestamp:
                            type: string
                            format: date-time
                          portionSize:
                            type: number
                          notes:
                            type: string
                            nullable: true
                          mealType:
                            type: string
                          unit:
                            type: string
        '400':
          description: Dados inválidos
        '403':
          description: Acesso negado
        '404':
          description: Alimentação não encontrada
    
    delete:
      tags: [Feedings]
      summary: Deletar alimentação (v2)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Alimentação deletada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: ID inválido
        '403':
          description: Acesso negado
        '404':
          description: Alimentação não encontrada

  /feedings/stats:
    get:
      tags: [Feedings]
      summary: Estatísticas de alimentação (v2)
      security:
        - BearerAuth: []
      parameters:
        - name: catId
          in: query
          schema:
            type: string
            format: uuid
        - name: days
          in: query
          schema:
            type: integer
            default: 7
            minimum: 1
            maximum: 90
      responses:
        '200':
          description: Estatísticas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /feedings/last/{catId}:
    get:
      tags: [Feedings]
      summary: Buscar última alimentação do gato (v2)
      description: Retorna a última alimentação registrada para um gato específico
      security:
        - BearerAuth: []
      parameters:
        - name: catId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Última alimentação ou null se não houver
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        nullable: true
                        properties:
                          id:
                            type: string
                            format: uuid
                          catId:
                            type: string
                            format: uuid
                          userId:
                            type: string
                            format: uuid
                          timestamp:
                            type: string
                            format: date-time
                          portionSize:
                            type: number
                          notes:
                            type: string
                            nullable: true
                          mealType:
                            type: string
                          unit:
                            type: string
                          householdId:
                            type: string
                            format: uuid
        '403':
          description: Acesso negado
        '404':
          description: Gato não encontrado

  /feedings/batch:
    post:
      tags: [Feedings]
      summary: Registrar múltiplas alimentações (v2)
      description: Cria múltiplos registros de alimentação em uma única requisição
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - logs
              properties:
                logs:
                  type: array
                  minItems: 1
                  items:
                    type: object
                    required:
                      - catId
                      - portionSize
                      - timestamp
                    properties:
                      catId:
                        type: string
                        format: uuid
                      portionSize:
                        type: number
                        minimum: 0
                      timestamp:
                        type: string
                        format: date-time
                      notes:
                        type: string
                      status:
                        type: string
                        enum: [Normal, Comeu Pouco, Recusou, Vomitou, Outro]
                      mealType:
                        type: string
                        enum: [dry, wet, treat, medicine, water, manual, scheduled, automatic]
                        default: manual
                      unit:
                        type: string
                        enum: [g, ml, cups, oz]
                        default: g
                      tempId:
                        type: string
      responses:
        '201':
          description: Alimentações criadas com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          count:
                            type: integer
                          logs:
                            type: array
                            items:
                              type: object
                      warnings:
                        type: array
                        items:
                          type: string
        '400':
          description: Dados inválidos
        '403':
          description: Acesso negado

  /feedings/cats:
    get:
      tags: [Feedings]
      summary: Listar gatos para alimentação (v2)
      description: Retorna lista de gatos do household para uso em formulários de alimentação
      security:
        - BearerAuth: []
      parameters:
        - name: householdId
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Lista de gatos
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Cat'
        '400':
          description: householdId obrigatório
        '403':
          description: Acesso negado

  # ==================== WEIGHT LOGS ====================
  /weight-logs:
    get:
      tags: [Weight]
      summary: Listar registros de peso (v2)
      security:
        - BearerAuth: []
      parameters:
        - name: catId
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Lista de registros
    
    post:
      tags: [Weight]
      summary: Criar registro de peso (v2)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - catId
                - weight
                - date
              properties:
                catId:
                  type: string
                  format: uuid
                weight:
                  type: number
                date:
                  type: string
                  pattern: '^[0-9]{4}-[0-9]{2}-[0-9]{2}$'
                notes:
                  type: string
      responses:
        '201':
          description: Registro criado
    
    put:
      tags: [Weight]
      summary: Atualizar registro de peso (v2)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - catId
                - weight
                - date
              properties:
                catId:
                  type: string
                  format: uuid
                weight:
                  type: number
                date:
                  type: string
      responses:
        '200':
          description: Registro atualizado
    
    delete:
      tags: [Weight]
      summary: Deletar registro de peso (v2)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Registro deletado

  # ==================== GOALS ====================
  /goals:
    get:
      tags: [Goals]
      summary: Listar metas de peso (v2)
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Lista de metas
    
    post:
      tags: [Goals]
      summary: Criar meta de peso (v2)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - cat_id
                - goal_name
                - target_weight
              properties:
                cat_id:
                  type: string
                  format: uuid
                goal_name:
                  type: string
                target_weight:
                  type: number
                unit:
                  type: string
                  enum: [kg, lbs]
      responses:
        '201':
          description: Meta criada

  # ==================== SCHEDULES ====================
  /schedules:
    get:
      tags: [Schedules]
      summary: Listar agendamentos (v2)
      security:
        - BearerAuth: []
      parameters:
        - name: householdId
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Lista de agendamentos
    
    post:
      tags: [Schedules]
      summary: Criar agendamento (v2)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - catId
                - type
              properties:
                catId:
                  type: string
                  format: uuid
                type:
                  type: string
                  enum: [interval, fixedTime]
                interval:
                  type: integer
                times:
                  type: array
                  items:
                    type: string
      responses:
        '201':
          description: Agendamento criado

  /schedules/{id}:
    get:
      tags: [Schedules]
      summary: Buscar agendamento (v2)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Dados do agendamento
    
    patch:
      tags: [Schedules]
      summary: Atualizar agendamento (v2)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Agendamento atualizado
    
    delete:
      tags: [Schedules]
      summary: Deletar agendamento (v2)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Agendamento deletado

  # ==================== HOUSEHOLDS ====================
  /households:
    get:
      tags: [Households]
      summary: Listar domicílios (v2)
      description: Retorna todos os domicílios do usuário autenticado
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Lista de domicílios
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                            name:
                              type: string
                            owner_id:
                              type: string
                              format: uuid
                            created_at:
                              type: string
                              format: date-time
                            members:
                              type: array
                              items:
                                type: object
        '401':
          description: Não autorizado
    
    post:
      tags: [Households]
      summary: Criar domicílio (v2)
      description: Cria um novo domicílio e adiciona o usuário como admin
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  minLength: 1
                  example: "Minha Casa"
      responses:
        '201':
          description: Domicílio criado com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          name:
                            type: string
                          owner_id:
                            type: string
                            format: uuid
                          members:
                            type: array
        '400':
          description: Dados inválidos
        '401':
          description: Não autorizado

  /households/{id}:
    get:
      tags: [Households]
      summary: Buscar domicílio (v2)
      description: Retorna detalhes de um domicílio específico
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Detalhes do domicílio
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          name:
                            type: string
                          inviteCode:
                            type: string
                          members:
                            type: array
                          cats:
                            type: array
                          owner:
                            type: object
        '403':
          description: Acesso negado
        '404':
          description: Domicílio não encontrado
    
    patch:
      tags: [Households]
      summary: Atualizar domicílio (v2)
      description: Atualiza informações do domicílio (apenas admins)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
      responses:
        '200':
          description: Domicílio atualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Dados inválidos
        '403':
          description: Apenas administradores podem atualizar
        '404':
          description: Domicílio não encontrado
    
    delete:
      tags: [Households]
      summary: Deletar domicílio (v2)
      description: Deleta um domicílio e todos os dados relacionados (apenas admins)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Domicílio deletado com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      message:
                        type: string
        '403':
          description: Apenas administradores podem deletar
        '404':
          description: Domicílio não encontrado

  /households/{id}/members:
    get:
      tags: [Households]
      summary: Listar membros (v2)
      description: Retorna lista de membros do domicílio
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Lista de membros
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                            name:
                              type: string
                            email:
                              type: string
                            role:
                              type: string
                              enum: [admin, ADMIN, member, MEMBER]
                            isCurrentUser:
                              type: boolean
        '403':
          description: Acesso negado
        '404':
          description: Domicílio não encontrado
    
    post:
      tags: [Households]
      summary: Adicionar membro (v2)
      description: Adiciona um novo membro ao domicílio por email (apenas admins)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - role
              properties:
                email:
                  type: string
                  format: email
                  example: "amigo@example.com"
                role:
                  type: string
                  enum: [admin, member, ADMIN, MEMBER]
                  example: "member"
      responses:
        '201':
          description: Membro adicionado com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: string
                          name:
                            type: string
                          email:
                            type: string
                          role:
                            type: string
        '400':
          description: Usuário já é membro ou pertence a outro domicílio
        '403':
          description: Apenas administradores podem adicionar membros
        '404':
          description: Usuário não encontrado

  /households/{id}/members/{userId}:
    delete:
      tags: [Households]
      summary: Remover membro (v2)
      description: Remove um membro do domicílio (apenas admins)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID do domicílio
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID do usuário a ser removido
      responses:
        '200':
          description: Membro removido com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      message:
                        type: string
        '400':
          description: Não é possível remover o último admin ou remover a si mesmo
        '403':
          description: Apenas administradores podem remover membros
        '404':
          description: Membro não encontrado

  /households/{id}/feeding-logs:
    get:
      tags: [Households]
      summary: Buscar logs de alimentação (v2)
      description: Retorna logs de alimentação dos gatos do domicílio com paginação
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
            minimum: 1
            maximum: 500
          description: Número máximo de registros a retornar
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Número de registros para pular (paginação)
        - name: catId
          in: query
          schema:
            type: string
            format: uuid
          description: Filtrar por gato específico
      responses:
        '200':
          description: Lista de logs de alimentação
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                            catId:
                              type: string
                              format: uuid
                            userId:
                              type: string
                              format: uuid
                            timestamp:
                              type: string
                              format: date-time
                            portionSize:
                              type: number
                            notes:
                              type: string
                      totalCount:
                        type: integer
                      pagination:
                        type: object
                        properties:
                          limit:
                            type: integer
                          offset:
                            type: integer
                          hasMore:
                            type: boolean
        '403':
          description: Acesso negado
        '404':
          description: Domicílio não encontrado

  /households/{id}/cats:
    get:
      tags: [Households]
      summary: Listar gatos do household (v2)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Lista de gatos
    
    post:
      tags: [Households]
      summary: Adicionar gato ao household (v2)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                weight:
                  type: number
      responses:
        '201':
          description: Gato adicionado

  /households/{id}/invite:
    post:
      tags: [Households]
      summary: Convidar membro (v2)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Convite enviado

  /households/{id}/invite-code:
    patch:
      tags: [Households]
      summary: Regenerar código de convite (v2)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Código regenerado
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          inviteCode:
                            type: string

  /households/invites/{notificationId}/accept:
    post:
      tags: [Households]
      summary: Aceitar convite para domicílio (v2)
      description: Aceita um convite para participar de um domicílio baseado no ID da notificação
      security:
        - BearerAuth: []
      parameters:
        - name: notificationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID da notificação de convite
      responses:
        '200':
          description: Convite aceito com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      message:
                        type: string
                      data:
                        type: object
                        properties:
                          household:
                            type: object
                            properties:
                              id:
                                type: string
                                format: uuid
                              name:
                                type: string
        '400':
          description: Dados inválidos ou tipo de notificação inválido
        '403':
          description: Convite não pertence ao usuário autenticado
        '404':
          description: Notificação ou domicílio não encontrado

  /households/invites/{notificationId}/reject:
    post:
      tags: [Households]
      summary: Rejeitar convite para domicílio (v2)
      description: Rejeita um convite para participar de um domicílio baseado no ID da notificação
      security:
        - BearerAuth: []
      parameters:
        - name: notificationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID da notificação de convite
      responses:
        '200':
          description: Convite rejeitado com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      message:
                        type: string
        '400':
          description: Dados inválidos ou tipo de notificação inválido
        '403':
          description: Convite não pertence ao usuário autenticado
        '404':
          description: Notificação não encontrada

  # ==================== NOTIFICATIONS ====================
  /notifications:
    get:
      tags: [Notifications]
      summary: Listar notificações do usuário (v2)
      description: Retorna lista paginada de notificações do usuário autenticado
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Número da página
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
          description: Itens por página
        - name: unreadOnly
          in: query
          schema:
            type: string
            enum: [true, false]
            default: false
          description: Retornar apenas notificações não lidas
      responses:
        '200':
          description: Lista de notificações
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          notifications:
                            type: array
                            items:
                              $ref: '#/components/schemas/Notification'
                          pagination:
                            type: object
                            properties:
                              page:
                                type: integer
                              limit:
                                type: integer
                              total:
                                type: integer
                              totalPages:
                                type: integer
                              hasMore:
                                type: boolean
        '400':
          description: Parâmetros inválidos
    
    post:
      tags: [Notifications]
      summary: Criar notificação (v2)
      description: Cria uma nova notificação para o usuário autenticado
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - message
                - type
              properties:
                title:
                  type: string
                  minLength: 1
                  maxLength: 255
                message:
                  type: string
                  minLength: 1
                  maxLength: 1000
                type:
                  type: string
                  enum: [feeding, reminder, household, household_invite, system, info, warning, error]
                isRead:
                  type: boolean
                  default: false
                metadata:
                  type: object
                  additionalProperties: true
      responses:
        '201':
          description: Notificação criada
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Notification'
        '400':
          description: Dados inválidos

  /notifications/bulk:
    patch:
      tags: [Notifications]
      summary: Operações em lote em notificações (v2)
      description: Marcar múltiplas notificações como lidas ou marcar todas como lidas
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - action
              properties:
                action:
                  type: string
                  enum: [mark_as_read, mark_all_as_read]
                  description: Ação a ser executada
                ids:
                  type: array
                  items:
                    type: string
                    format: uuid
                  minItems: 1
                  maxItems: 100
                  description: IDs das notificações (obrigatório para mark_as_read)
      responses:
        '200':
          description: Operação realizada com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          updatedCount:
                            type: integer
                          action:
                            type: string
                      message:
                        type: string
        '400':
          description: Dados inválidos
    
    delete:
      tags: [Notifications]
      summary: Deletar múltiplas notificações (v2)
      description: Deleta múltiplas notificações do usuário autenticado
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - ids
              properties:
                ids:
                  type: array
                  items:
                    type: string
                    format: uuid
                  minItems: 1
                  maxItems: 100
      responses:
        '200':
          description: Notificações deletadas
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          deletedCount:
                            type: integer
                      message:
                        type: string
        '400':
          description: Dados inválidos

  /notifications/{id}:
    get:
      tags: [Notifications]
      summary: Buscar notificação específica (v2)
      description: Retorna uma notificação específica do usuário autenticado
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Dados da notificação
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Notification'
        '404':
          description: Notificação não encontrada
    
    patch:
      tags: [Notifications]
      summary: Atualizar notificação (v2)
      description: Atualiza uma notificação (principalmente para marcar como lida/não lida)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                isRead:
                  type: boolean
      responses:
        '200':
          description: Notificação atualizada
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Notification'
        '404':
          description: Notificação não encontrada
    
    delete:
      tags: [Notifications]
      summary: Deletar notificação (v2)
      description: Deleta uma notificação específica do usuário autenticado
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Notificação deletada com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      message:
                        type: string
        '404':
          description: Notificação não encontrada

  # ==================== STATISTICS ====================
  /statistics:
    get:
      tags: [Statistics]
      summary: Obter estatísticas de alimentação (v2)
      description: Retorna estatísticas consolidadas de alimentação
      security:
        - BearerAuth: []
      parameters:
        - name: period
          in: query
          schema:
            type: string
            enum: [7dias, 30dias, 3meses]
            default: 7dias
          description: Período para calcular estatísticas
        - name: catId
          in: query
          schema:
            type: string
            format: uuid
          description: Filtrar por gato específico (opcional, "todos" por padrão)
      responses:
        '200':
          description: Estatísticas de alimentação
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          totalFeedings:
                            type: integer
                          averagePortionSize:
                            type: number
                          maxConsecutiveDays:
                            type: integer
                          missedSchedules:
                            type: integer
                          timeSeriesData:
                            type: array
                            items:
                              type: object
                          catPortionData:
                            type: array
                            items:
                              type: object
                          timeDistributionData:
                            type: array
                            items:
                              type: object
                          feedingLogs:
                            type: array
        '400':
          description: Parâmetros inválidos
        '403':
          description: Acesso negado
        '404':
          description: Perfil não encontrado

  # ==================== UPLOAD ====================
  /upload:
    post:
      tags: [Upload]
      summary: Upload de arquivo (v2)
      description: Faz upload de imagem (foto de gato ou usuário)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Arquivo de imagem
                type:
                  type: string
                  enum: [user, cat, thumbnail]
                  default: user
                  description: Tipo de upload
      responses:
        '201':
          description: Upload realizado com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          url:
                            type: string
                            format: uri
        '400':
          description: Arquivo inválido ou ausente
        '401':
          description: Não autenticado

  # ==================== PROFILE ====================
  /profile/{idOrUsername}:
    get:
      tags: [Profile]
      summary: Buscar perfil público (v2)
      description: Retorna perfil público de um usuário (por ID ou username)
      security:
        - BearerAuth: []
      parameters:
        - name: idOrUsername
          in: path
          required: true
          schema:
            type: string
          description: ID do usuário (UUID) ou username
      responses:
        '200':
          description: Perfil público do usuário
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          username:
                            type: string
                            nullable: true
                          full_name:
                            type: string
                            nullable: true
                          avatar_url:
                            type: string
                            nullable: true
                          email:
                            type: string
                          timezone:
                            type: string
                            nullable: true
                          household_members:
                            type: array
                            items:
                              type: object
                          owned_cats:
                            type: array
                            items:
                              type: object
        '400':
          description: ID ou username inválido
        '404':
          description: Perfil não encontrado
    
    put:
      tags: [Profile]
      summary: Atualizar perfil público (v2)
      description: Atualiza o próprio perfil (usuário deve estar autenticado e ser o dono do perfil)
      security:
        - BearerAuth: []
      parameters:
        - name: idOrUsername
          in: path
          required: true
          schema:
            type: string
          description: ID do usuário (UUID) ou username
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                full_name:
                  type: string
                  minLength: 2
                  maxLength: 100
                username:
                  type: string
                  minLength: 3
                  maxLength: 30
                email:
                  type: string
                  format: email
                avatar_url:
                  type: string
                  nullable: true
                  format: uri
                timezone:
                  type: string
                  maxLength: 50
      responses:
        '200':
          description: Perfil atualizado com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
        '400':
          description: Dados inválidos
        '403':
          description: Acesso negado (usuário não pode atualizar outro perfil)
        '404':
          description: Perfil não encontrado

  # ==================== HOUSEHOLDS JOIN ====================
  /households/join:
    post:
      tags: [Households]
      summary: Entrar em domicílio via código (v2)
      description: Entra em um domicílio usando um código de convite
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - inviteCode
              properties:
                inviteCode:
                  type: string
                  minLength: 1
                  example: "ABC123"
      responses:
        '201':
          description: Usuário entrou no domicílio com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          name:
                            type: string
                          inviteCode:
                            type: string
                          members:
                            type: array
                            items:
                              type: object
                          cats:
                            type: array
                            items:
                              type: object
        '400':
          description: Código inválido ou usuário já pertence a domicílio
        '403':
          description: Acesso negado
        '404':
          description: Código de convite inválido

  # ==================== SCHEDULED NOTIFICATIONS ====================
  /scheduled-notifications:
    get:
      tags: [ScheduledNotifications]
      summary: Listar notificações agendadas (v2)
      description: Retorna lista de notificações agendadas do usuário
      security:
        - BearerAuth: []
      parameters:
        - name: delivered
          in: query
          schema:
            type: boolean
          description: Filtrar por entregue ou não (true/false)
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
          description: Número máximo de registros
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Offset para paginação
      responses:
        '200':
          description: Lista de notificações agendadas
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          notifications:
                            type: array
                            items:
                              type: object
                          pagination:
                            type: object
                            properties:
                              limit:
                                type: integer
                              offset:
                                type: integer
                              total:
                                type: integer
                              hasMore:
                                type: boolean
    
    post:
      tags: [ScheduledNotifications]
      summary: Criar notificação agendada (v2)
      description: Agenda uma notificação para ser entregue em uma data futura
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - type
                - title
                - message
                - scheduledFor
              properties:
                type:
                  type: string
                  minLength: 1
                title:
                  type: string
                  minLength: 1
                message:
                  type: string
                  minLength: 1
                scheduledFor:
                  type: string
                  format: date-time
                  description: Data/hora em formato ISO-8601 (UTC) para entrega
                catId:
                  type: string
                  format: uuid
                  nullable: true
      responses:
        '201':
          description: Notificação agendada criada
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          userId:
                            type: string
                            format: uuid
                          type:
                            type: string
                          title:
                            type: string
                          message:
                            type: string
                          deliverAt:
                            type: string
                            format: date-time
                          delivered:
                            type: boolean
        '400':
          description: Dados inválidos ou data no passado
        '401':
          description: Não autenticado

  /scheduled-notifications/deliver:
    post:
      tags: [ScheduledNotifications]
      summary: Entregar notificações pendentes (v2)
      description: Processa e entrega notificações agendadas que estão vencidas
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Notificações entregues
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          delivered:
                            type: integer
                          notifications:
                            type: array
                            items:
                              type: object
        '500':
          description: Erro interno do servidor

  # ==================== USERS ====================
  /users/{id}:
    get:
      tags: [Users]
      summary: Obter informações do usuário (v2)
      description: Retorna informações do perfil do usuário autenticado
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID do usuário (deve corresponder ao usuário autenticado)
      responses:
        '200':
          description: Informações do usuário
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/User'
        '401':
          description: Não autenticado
        '403':
          description: Acesso negado (usuário tentando acessar dados de outro usuário)
        '404':
          description: Usuário não encontrado
    
    put:
      tags: [Users]
      summary: Atualizar informações do usuário (v2)
      description: Atualiza informações do perfil do usuário autenticado
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID do usuário (deve corresponder ao usuário autenticado)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                full_name:
                  type: string
                  minLength: 1
                  description: Nome completo do usuário
                username:
                  type: string
                  minLength: 1
                  description: Nome de usuário único
                avatar_url:
                  type: string
                  nullable: true
                  format: uri
                  description: URL do avatar do usuário
      responses:
        '200':
          description: Usuário atualizado com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/User'
        '400':
          description: Dados inválidos
        '401':
          description: Não autenticado
        '403':
          description: Acesso negado (usuário tentando atualizar dados de outro usuário)
        '404':
          description: Usuário não encontrado

  /users/{id}/preferences:
    get:
      tags: [Users]
      summary: Obter preferências do usuário (v2)
      description: Retorna preferências do usuário autenticado
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID do usuário (deve corresponder ao usuário autenticado)
      responses:
        '200':
          description: Preferências do usuário
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/UserPreferences'
        '401':
          description: Não autenticado
        '403':
          description: Acesso negado (usuário tentando acessar preferências de outro usuário)
        '404':
          description: Usuário não encontrado
    
    put:
      tags: [Users]
      summary: Atualizar preferências do usuário (v2)
      description: Atualiza preferências do usuário autenticado. Nota: o campo 'language' não é persistido no banco de dados, apenas 'timezone' é salvo.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID do usuário (deve corresponder ao usuário autenticado)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - timezone
              properties:
                language:
                  type: string
                  minLength: 1
                  description: Idioma do usuário (não persistido no banco de dados)
                timezone:
                  type: string
                  minLength: 1
                  description: Timezone do usuário (ex: America/Sao_Paulo)
      responses:
        '200':
          description: Preferências atualizadas com sucesso
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/UserPreferences'
        '400':
          description: Dados inválidos
        '401':
          description: Não autenticado
        '403':
          description: Acesso negado (usuário tentando atualizar preferências de outro usuário)
        '404':
          description: Usuário não encontrado

